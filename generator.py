import time
import random
from datetime import datetime

class ScenarioGenerator:
    def __init__(self, data_queue):
        """
        :param data_queue: ë©”ì¸ í”„ë¡œì„¸ìŠ¤ì™€ ê³µìœ í•˜ëŠ” ë©”ì‹œì§€ í
        """
        self.queue = data_queue
        self.is_running = False
        
        # [ê³µí†µ] ë“±ì¥ì¸ë¬¼ (Shared Actors)
        self.subjects = [
            "ê¹€ì² ìˆ˜ ë¶€ì¥", "ì´ì˜í¬ ëŒ€ë¦¬", "ë°•ë¯¼ìˆ˜ ì „ë¬´", "ê³½ë„ì› ìƒë¬´", "ì‹ ì› ë¯¸ìƒ"
        ]

        # ---------------------------------------------------------
        # [Scenario A] ë³´ì•ˆ/ì²©ë³´/ë²”ì£„ ê´€ë ¨ ë°ì´í„° (ê¸°ì¡´)
        # ---------------------------------------------------------
        self.sec_locations = ["ì¹´í˜ ë¸”ë£¨", "ì¸ì²œê³µí•­", "ì§€í•˜ ì£¼ì°¨ì¥", "ë³¸ì‚¬ ì„œë²„ì‹¤", "ê°•ë‚¨ ë¹„ë°€ í´ëŸ½", "ë¹„ìƒê³„ë‹¨"]
        self.sec_actions = [
            "ëˆ„êµ°ê°€ì™€ ì€ë°€í•˜ê²Œ í†µí™”í•˜ëŠ” ëª¨ìŠµì´ í¬ì°©ë¨",
            "ëŒ€ìš©ëŸ‰ íŒŒì¼ì„ USBì— ë³µì‚¬í•¨",
            "ë²•ì¸ì¹´ë“œë¡œ 50ë§Œì›ì„ ê²°ì œí•¨",
            "ê²€ì€ìƒ‰ ê°€ë°©ì„ ëˆ„êµ°ê°€ì—ê²Œ ê±´ë„¤ì¤Œ",
            "ë¹„íŠ¸ì½”ì¸ ì§€ê°‘ì„ í™•ì¸í•˜ë©° í•œìˆ¨ì„ ì‰¼",
            "í™©ê¸‰íˆ íƒì‹œë¥¼ íƒ€ê³  ì´ë™í•¨",
            "ë³´ì•ˆ ì‹œìŠ¤í…œ ì ‘ì†ì„ ì‹œë„í•˜ë‹¤ ì‹¤íŒ¨í•¨",
            "CCTV ì‚¬ê°ì§€ëŒ€ì—ì„œ ì„œì„±ì„"
        ]
        self.sec_sources = ["CCTV", "ì²­ì†Œë¶€ ëª©ê²©ë‹´", "ë³´ì•ˆ ë¡œê·¸", "ì¹´ë“œ ìŠ¹ì¸ ë‚´ì—­", "ë„ì²­ ê¸°ë¡"]

        # ---------------------------------------------------------
        # [Scenario B] ì¸ì‚¬/í‰íŒ/ê°ˆë“± ê´€ë ¨ ë°ì´í„°
        # ---------------------------------------------------------
        self.hr_locations = ["í¡ì—°ì‹¤", "íƒ•ë¹„ì‹¤", "ì¸ì‚¬íŒ€ ìƒë‹´ì‹¤", "ë¸”ë¼ì¸ë“œ ì•±", "íšŒì˜ì‹¤ B", "ì‚¬ë‚´ ë©”ì‹ ì €", "íšŒì‹ ì¥ì†Œ"]
        self.hr_actions = [
            "íŒ€ì¥ê³¼ì˜ ë¶ˆí™”ë¡œ ì¸í•´ ê³ ì„±ì„ ì§€ë¥´ë©° ì‹¸ì›€",
            "ê²½ìŸì‚¬ë¡œ ì´ì§í•œë‹¤ëŠ” ì†Œë¬¸ì´ ëŒê³  ìˆìŒ",
            "ì¸ì‚¬ê³ ê³¼ì—ì„œ ìµœí•˜ìœ„ ë“±ê¸‰(D)ì„ ë°›ì•„ ë¶ˆë§Œì„ í† ë¡œí•¨",
            "ì§ì¥ ë‚´ ê´´ë¡­í˜ìœ¼ë¡œ ìµëª… ì‹ ê³ ë¥¼ ë‹¹í•¨",
            "ê³¼ë„í•œ ì—…ë¬´ ìŠ¤íŠ¸ë ˆìŠ¤ë¡œ ì¸í•´ íœ´ì§ì„ ì‹ ì²­í•¨",
            "íšŒì‹ ìë¦¬ì—ì„œ íšŒì‚¬ ê¸°ë°€ì„ ë°œì„¤í–ˆë‹¤ëŠ” ì œë³´ê°€ ë“¤ì–´ì˜´",
            "ê¸‰ì—¬ ê°€ì••ë¥˜ í†µì§€ì„œê°€ íšŒì‚¬ë¡œ ë„ì°©í•¨",
            "ë™ë£Œ ì§ì›ì—ê²Œ ëˆì„ ë¹Œë ¤ë‹¬ë¼ê³  ìš”êµ¬í•¨"
        ]
        self.hr_sources = ["ì¸ì‚¬ê¸°ë¡ë¶€", "ìµëª… íˆ¬ì„œ(ì‹ ë¬¸ê³ )", "ë‹¤ë©´í‰ê°€ ê²°ê³¼", "ë™ë£Œ ì§ì› ë©´ë‹´", "ì‚¬ë‚´ ë©”ì‹ ì € ë¡œê·¸", "ë¸”ë¼ì¸ë“œ ê²Œì‹œê¸€"]

    def generate_one(self):
        """ë³´ì•ˆ ì´ìŠˆì™€ HR ì´ìŠˆ ì¤‘ í•˜ë‚˜ë¥¼ ëœë¤í•˜ê²Œ ìƒì„±"""
        
        # 50% í™•ë¥ ë¡œ ë³´ì•ˆ(SEC) í˜¹ì€ ì¸ì‚¬(HR) ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ
        scenario_type = random.choice(["SEC", "HR"])
        timestamp = datetime.now().strftime("%H:%M:%S")

        if scenario_type == "SEC":
            # ë³´ì•ˆ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±
            who = random.choice(self.subjects)
            where = random.choice(self.sec_locations)
            what = random.choice(self.sec_actions)
            source = random.choice(self.sec_sources)
            content = f"[{timestamp}] [ë³´ì•ˆ-{source}] {where}ì—ì„œ {who}ì´(ê°€) {what}."
            
        else:
            # HR ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±
            who = random.choice(self.subjects)
            where = random.choice(self.hr_locations)
            what = random.choice(self.hr_actions)
            source = random.choice(self.hr_sources)
            content = f"[{timestamp}] [HR-{source}] {where}ì—ì„œ {who}ì´(ê°€) {what}."

        return content

    def run(self):
        """ë°ì´í„° ìƒì„± ë£¨í”„"""
        print("\nğŸ° [ì‹œë®¬ë ˆì´í„°] ê°€ìƒ ì‹œë‚˜ë¦¬ì˜¤(ë³´ì•ˆ+HR) ìƒì„±ì„ ì‹œì‘í•©ë‹ˆë‹¤. (5ì´ˆ~10ì´ˆ ê°„ê²©)")
        self.is_running = True
        
        while self.is_running:
            fake_news = self.generate_one()
            
            # ë©”ì¸ íì— ì£¼ì…
            self.queue.put(("AUTO_GEN", fake_news))
            
            # ëœë¤ ëŒ€ê¸°
            sleep_time = random.randint(5, 10)
            time.sleep(sleep_time)
            
    def stop(self):
        self.is_running = False
        print("\nğŸ›‘ [ì‹œë®¬ë ˆì´í„°] ìƒì„±ì„ ì¤‘ë‹¨í•©ë‹ˆë‹¤.")